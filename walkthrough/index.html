<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-walkthrough" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Walkthrough | Distributed Design</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jaimestill.github.io/distributed-design/img/social.png"><meta data-rh="true" name="twitter:image" content="https://jaimestill.github.io/distributed-design/img/social.png"><meta data-rh="true" property="og:url" content="https://jaimestill.github.io/distributed-design/walkthrough"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Walkthrough | Distributed Design"><meta data-rh="true" name="description" content="The nodes and apps built out in this repository are intended to demonstrate the real-time, cross-node data synchronization patterns enabled by the underlying libraries that they are built upon. The sections that follow will walk through the scenarios that demonstrate these patterns and highlight some of the infrastructure that enables the associated functionality."><meta data-rh="true" property="og:description" content="The nodes and apps built out in this repository are intended to demonstrate the real-time, cross-node data synchronization patterns enabled by the underlying libraries that they are built upon. The sections that follow will walk through the scenarios that demonstrate these patterns and highlight some of the infrastructure that enables the associated functionality."><link data-rh="true" rel="icon" href="/distributed-design/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jaimestill.github.io/distributed-design/walkthrough"><link data-rh="true" rel="alternate" href="https://jaimestill.github.io/distributed-design/walkthrough" hreflang="en"><link data-rh="true" rel="alternate" href="https://jaimestill.github.io/distributed-design/walkthrough" hreflang="x-default"><link rel="stylesheet" href="/distributed-design/assets/css/styles.75314c4a.css">
<link rel="preload" href="/distributed-design/assets/js/runtime~main.7ae0a603.js" as="script">
<link rel="preload" href="/distributed-design/assets/js/main.38f205fa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/distributed-design/"><div class="navbar__logo"><img src="/distributed-design/img/logo.png" alt="Distributed Design" class="themedImage_ToTc themedImage--light_HNdA"><img src="/distributed-design/img/logo.png" alt="Distributed Design" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Distributed Design</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/distributed-design/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/JaimeStill/distributed-design" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/distributed-design/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/distributed-design/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/distributed-design/walkthrough">Walkthrough</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/distributed-design/deployment">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/distributed-design/tutorial">Tutorial</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/distributed-design/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Walkthrough</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Walkthrough</h1><p>The nodes and apps built out in this repository are intended to demonstrate the real-time, cross-node data synchronization patterns enabled by the underlying libraries that they are built upon. The sections that follow will walk through the scenarios that demonstrate these patterns and highlight some of the infrastructure that enables the associated functionality.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>This guide assumes that you have already followed the steps in <a href="/distributed-design/getting-started">getting-started</a>.</p></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>This guide will provide a high-level overview of how the underlying functionality is enabled. The <a href="/distributed-design/tutorial">Tutorial</a> will provide a thorough step-by-step guide for how to build a node and an app with the underlying libraries.</p><p>Also, a lot of the infrastructure demonstrated in this walkthrough is from the underlying libraries. There is a lot of complexity that is exposed here to illustrate how this functionality is enabled. Reference the actual nodes (<a href="https://github.com/JaimeStill/distributed-design/tree/main/nodes/proposals" target="_blank" rel="noopener noreferrer"><em>Proposals</em></a> and <a href="https://github.com/JaimeStill/distributed-design/tree/main/nodes/workflows" target="_blank" rel="noopener noreferrer"><em>Workflows</em></a>) and apps (<a href="https://github.com/JaimeStill/distributed-design/tree/main/apps/proposals" target="_blank" rel="noopener noreferrer"><em>Proposals</em></a> and <a href="https://github.com/JaimeStill/distributed-design/tree/main/apps/workflows" target="_blank" rel="noopener noreferrer"><em>Workflows</em></a>) to see how the libraries simplify the implementation details.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h2><p>If you haven&#x27;t already, make sure that all nodes and apps are running. Be sure the apps are started with the approprate command (<code>npm run start:dev</code> if running local or <code>npm run start:code</code> if running in a codespace). The sections that follow will demonstrate how the API facilitates real time data synchronization and cross-node interactivity. With this in mind, you will want to configure two browser windows side by side with each app running in tabs in both windows:</p><p><img loading="lazy" alt="browser-setup" src="/distributed-design/assets/images/browser-setup-50ede6776b771d6f37b694eac0196778.png" width="1722" height="698" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-node-synchronization">Internal Node Synchronization<a href="#internal-node-synchronization" class="hash-link" aria-label="Direct link to Internal Node Synchronization" title="Direct link to Internal Node Synchronization">​</a></h2><p>Mutations to data within a node are executed through <code>Command</code> methods. This is typically exposed as a <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L154" target="_blank" rel="noopener noreferrer"><code>Save</code></a> method on a specific <code>Entity</code> type internally owned by the node. When a <code>Command</code> is executed, an <code>Event</code> is broadcast with a message containing the affected data. Any node or application with access to a <code>Listener</code> associated with the affected data can then react to the change in state.</p><p>If additional data mutations need to occur as a result of the command, these interactions can be defined through the use of <code>Hook</code> methods. These hooks represent points in the <code>Command</code> method where functionality can be injected. For instance, <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L34" target="_blank" rel="noopener noreferrer"><code>OnAdd</code></a> is executed prior to the mutations implemented in the internal <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L98" target="_blank" rel="noopener noreferrer"><code>Add</code></a> method. On the other hand, <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L40" target="_blank" rel="noopener noreferrer"><code>AfterUpdate</code></a> is executed after the mutations implemented in the internal <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L127" target="_blank" rel="noopener noreferrer"><code>Update</code></a> method. <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L36" target="_blank" rel="noopener noreferrer"><code>OnSave</code></a> is executed prior to the mutations of either <code>Add</code> or <code>Update</code> via the public <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L164" target="_blank" rel="noopener noreferrer"><code>Save</code></a> method.</p><p>You&#x27;ll notice that the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L160" target="_blank" rel="noopener noreferrer"><code>Save</code></a> and <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L190" target="_blank" rel="noopener noreferrer"><code>Remove</code></a> methods are <a href="https://learn.microsoft.com/en-us/ef/core/saving/transactions" target="_blank" rel="noopener noreferrer">transactional</a> through the use of <code>db.Database.BeginTransactionAsync</code>. If any aspect of the method fails, to include the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L24" target="_blank" rel="noopener noreferrer">result of any hook calls</a>, the entire transaction is rolled back.</p><p>To see this in action, execute the following steps with both browser windows showing the <em>Proposals</em> app:</p><ol><li><p>Click the <em>Create Proposal</em> button indicated by the plus icon to the left of the <strong>Home</strong> heading.</p></li><li><p>Provide a <code>Title</code> and <code>Value</code> in the <em>Add Proposal</em> dialog, then click <strong>Save Proposal</strong>:</p><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/287064bd-54de-4844-a3b5-f726afea3763"></video></li></ol><p>There are two things to note about this transaction:</p><ol><li><p>The <code>Proposal</code> record that was created synchronized across all connected instances of the Proposals app.</p></li><li><p>In addition to creating a <code>Proposal</code>, an associated <code>Status</code> was created (illustrated by the <em>Created</em> status to the top right of the Proposal card in the application).</p></li></ol><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs" target="_blank" rel="noopener noreferrer"><code>EntityCommand</code></a> class defines a <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L44" target="_blank" rel="noopener noreferrer"><code>SyncAdd</code></a> hook that is called after the internal <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L107" target="_blank" rel="noopener noreferrer"><code>Add</code></a> transaction is successful. Every <code>EntityCommand</code> must be initialized with an <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/Events/Hub/EventHub.cs" target="_blank" rel="noopener noreferrer"><code>EventHub</code></a>, which is a <a href="https://learn.microsoft.com/en-us/aspnet/core/signalr/hubs?view=aspnetcore-7.0#strongly-typed-hubs" target="_blank" rel="noopener noreferrer">strongly-typed SignalR hub</a> that is defined with an <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/Events/Hub/IEventHub.cs" target="_blank" rel="noopener noreferrer"><code>IEventHub</code></a> interface. When <code>SyncAdd</code> is called, it broadcasts the added entity through the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/Events/Hub/IEventHub.cs#L7" target="_blank" rel="noopener noreferrer"><code>IEventHub.OnAdd</code></a> method.</p><p>A TypeScript <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/core/src/services/events/event-listener.ts" target="_blank" rel="noopener noreferrer"><code>EventListener</code></a> class is provided that allows you to define interfaces to <code>EventHub</code> instances. In this case, a <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/services/proposal-listener.ts" target="_blank" rel="noopener noreferrer"><code>ProposalListener</code></a> is defined and injected into the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/routes/home/home.route.ts#L64" target="_blank" rel="noopener noreferrer"><code>HomeRoute</code></a>. In the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/routes/home/home.route.ts#L88" target="_blank" rel="noopener noreferrer"><code>ngOnInit</code></a> lifecycle hook, the listener is initialized and events are registered.</p><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs" target="_blank" rel="noopener noreferrer"><code>ProposalCommand</code></a> provides an <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs#L26" target="_blank" rel="noopener noreferrer"><code>AfterAdd</code></a> hook that <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/core/Extensions/StatusExtensions.cs#L6" target="_blank" rel="noopener noreferrer">generates a created status</a> and saves it to the proposal.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cross-node-synchronization">Cross-Node Synchronization<a href="#cross-node-synchronization" class="hash-link" aria-label="Direct link to Cross-Node Synchronization" title="Direct link to Cross-Node Synchronization">​</a></h2><p>There are three primary interfaces that facilitate cross-node interactivity:</p><ul><li><code>Contract</code> - an object that is sent to the remote node to initiate interactivity and track progress across the service lifetime.<ul><li><a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/workflows/Classes/Package.cs" target="_blank" rel="noopener noreferrer"><code>Package</code></a> is a <em>Workflows</em> node <code>Contract</code>.</li></ul></li><li><code>Gateway</code> - the API interface for sending to and retrieving data from a remote node.<ul><li><a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Api/Controllers/GatewayController.cs" target="_blank" rel="noopener noreferrer"><code>GatewayController</code></a> defines the <code>Gateway</code> API for the <em>Workflows</em> node.</li><li><a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/workflows/WorkflowsGateway.cs" target="_blank" rel="noopener noreferrer"><code>WorkflowsGateway</code></a> is the <code>Gateway</code> Service for interfacing with the <em>Workflows</em> node.</li></ul></li><li><code>Listener</code> - the event listener provided by the remote node for tracking contract events.<ul><li><a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Event/Listeners/PackageEventListener.cs" target="_blank" rel="noopener noreferrer"><code>PackageEventListener</code></a> handles <code>Package</code> events generated by <em>Workflows</em> node.</li></ul></li></ul><p>The following scenarios show patterns for working with these interfaces.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="submitting-a-contract">Submitting a Contract<a href="#submitting-a-contract" class="hash-link" aria-label="Direct link to Submitting a Contract" title="Direct link to Submitting a Contract">​</a></h3><p>The following interactions occur to facilitate submitting a contract to a remote node:</p><ol><li>The data for the contract is filled out by the initiating node</li><li>The contract is sent through the gateway interface for the remote node</li><li>The remote node receives and processes the contract</li><li>The remote node broadcasts an event when the contract has been successfully processed</li></ol><p>To see this in action, set the left browser tab to the <em>Proposals</em> app and the right browser tab to the <em>Workflows</em> app. Execute the following steps:</p><ol><li><p>In the <em>Proposals</em> app on the <em>Documentation Proposal</em> card, click the middle <strong>Submit Package</strong> icon button represented by a blue right-facing arrow.</p></li><li><p>A <em>PackageDialog</em> will open. Provide entries for <code>Title</code> and <code>Value</code>, then click <strong>Save Package</strong>.</p></li></ol><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/2891310b-fab6-4a75-9d90-08ab59aa9aed"></video><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/distributed/projects/toolkit/src/dialogs/package.dialog.ts" target="_blank" rel="noopener noreferrer"><code>PackageDialog</code></a> used to submit the package, along with its associated <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/distributed/projects/toolkit/src/forms/package.form.ts" target="_blank" rel="noopener noreferrer"><code>PackageForm</code></a>, are exposed through the <a href="https://github.com/JaimeStill/distributed-design/tree/main/apps/libs/distributed/projects/toolkit" target="_blank" rel="noopener noreferrer"><code>@distributed/toolkit</code></a> library as part of the common infrastructure for interfacing with the Workflows node. When the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/contracts/workflows/src/interfaces/package.ts" target="_blank" rel="noopener noreferrer"><code>Package</code></a> contract is saved through the PackageForm, it uses the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/distributed/projects/toolkit/src/gateways/workflows.gateway.ts" target="_blank" rel="noopener noreferrer"><code>WorkflowsGateway</code></a> service to submit the package. The gateway endpoint is configured within each app whenever the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/distributed/projects/toolkit/src/toolkit.module.ts" target="_blank" rel="noopener noreferrer"><code>ToolkitModule</code></a> is imported (see <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/app.module.ts#L42" target="_blank" rel="noopener noreferrer">Proposals - AppModule</a>).</p><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Api/Controllers/GatewayController.cs#L45" target="_blank" rel="noopener noreferrer"><code>GatewayController.SubmitPackage</code></a> method in the workflows node passes the received package to the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs#L17" target="_blank" rel="noopener noreferrer"><code>PackageCommand.Submit</code></a> method. Since this is a new package, the <code>Save</code> method will be called, which will trigger the <code>PackageCommand.SyncAdd</code> hook (in the same way as the <code>ProposalCommand</code> service when a new Proposal is created).</p><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/libs/distributed/projects/toolkit/src/nodes/package-listener.ts" target="_blank" rel="noopener noreferrer"><code>PackageListener</code></a> defined in <code>@distributed/toolkit</code> is injected in the home route of both the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/routes/home/home.route.ts#L59" target="_blank" rel="noopener noreferrer">proposals app</a> and the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/workflows/src/app/routes/home/home.route.ts#L37" target="_blank" rel="noopener noreferrer">workflows app</a>. Both routes initialize the listener in the respective <code>ngOnInit</code> lifecycle hooks: see <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/routes/home/home.route.ts#L82" target="_blank" rel="noopener noreferrer">proposals</a> and <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/workflows/src/app/routes/home/home.route.ts#L71" target="_blank" rel="noopener noreferrer">workflows</a>.</p><p>The proposals app uses an <code>Observable</code> trigger to feed into each <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/components/proposal-card.component.ts#L54" target="_blank" rel="noopener noreferrer"><code>ProposalCard</code></a>. The card component uses this trigger to <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/components/proposal-card.component.ts#L106" target="_blank" rel="noopener noreferrer">handle package events</a> if the received event is associated with its proposal.</p><p>If you retrieve the <code>Proposal</code> both before and after submitting the <code>Package</code>, you&#x27;ll notice that a <code>packageId</code> is assigned when a <code>Package</code> is successfully submitted:</p><p><strong>Before</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;statusId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;title&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documentation Proposal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Proposals.Entities.Proposal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A demonstrative Proposoal for documentation purposes.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;dateCreated&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-10-13T12:38:52.3668313&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;dateModified&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-10-13T13:11:11.73073&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>After</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;statusId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;packageId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;title&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Documentation Proposal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Proposals.Entities.Proposal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;A demonstrative Proposoal for documentation purposes.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;dateCreated&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-10-13T12:38:52.3668313&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;dateModified&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2023-10-13T13:15:11.73073&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Leveraging an <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/Events/Client/EventListener.cs" target="_blank" rel="noopener noreferrer"><code>EventListener</code></a> is not exclusive to client apps. In fact, synchronizing node data that&#x27;s associated with contracts in remote nodes is exclusively handled through <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntitySaga.cs" target="_blank" rel="noopener noreferrer"><code>EntitySaga</code></a> services through events.</p><p>In this case, the proposals node defines a <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Event/Listeners/PackageEventListener.cs" target="_blank" rel="noopener noreferrer"><code>PackageListener</code></a> that reacts to <code>Package</code> events. In this case, whenever a <code>Package</code> is added, the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Event/Listeners/PackageEventListener.cs#L18" target="_blank" rel="noopener noreferrer"><code>OnAdd</code></a> event triggers the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Saga/PackageSaga.cs#L21" target="_blank" rel="noopener noreferrer"><code>PackageSaga.OnAdd</code></a> method. Internal changes spawned by a <code>Saga</code> will still broadcast update events for the affected Entities.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reacting-to-contract-changes">Reacting to Contract Changes<a href="#reacting-to-contract-changes" class="hash-link" aria-label="Direct link to Reacting to Contract Changes" title="Direct link to Reacting to Contract Changes">​</a></h3><p>The <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Event/PackageEventHub.cs" target="_blank" rel="noopener noreferrer"><code>PackageEventHub</code></a> defined by the workflows node provides an additional <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Event/IPackageEventHub.cs#L7" target="_blank" rel="noopener noreferrer"><code>OnStateChanged</code></a> event. This is used to isolate changes to <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/workflows/Classes/Package.cs#L10" target="_blank" rel="noopener noreferrer"><code>Package.State</code></a> from changes to the editable <code>Package</code> entity fields.</p><p>In the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs" target="_blank" rel="noopener noreferrer"><code>PackageCommand</code></a> service, there is validation to ensure <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs#L121" target="_blank" rel="noopener noreferrer">state is not improperly modified</a> as well as validation to <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs#L103" target="_blank" rel="noopener noreferrer">ensure proper state transitions</a>. Also, a <code>Package</code> can only be modified <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs#L128" target="_blank" rel="noopener noreferrer">if it is not in a completed state</a>.</p><p>The <code>PackageCommand</code> service also defines methods for <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs#L22" target="_blank" rel="noopener noreferrer">changing the state</a> of a <code>Package</code>.</p><p>In the Workflows app, pending packages provide three actions for handling that package:</p><p><img loading="lazy" alt="pending-package-card" src="data:image/png;base64,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" width="364" height="150" class="img_ev3q"></p><p>From left to right, those actions are:</p><ul><li><strong>Reject</strong> - permanently reject the package that was submitted</li><li><strong>Return</strong> - return the package that was submitted for corrections</li><li><strong>Approve</strong> - approve the package and change the status to the associated <code>Entity</code></li></ul><p>The following clips demonstrate returning, resubmitting, and approving:</p><p><strong>Returning a Package</strong></p><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/de84c3ef-bca0-48fe-8a09-83d7e655c3da"></video><p><strong>Resubmitting a Package</strong></p><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/c8652959-d902-4c57-87dc-807d07ffdabe"></video><p><strong>Approving a Package</strong></p><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/4d5314dd-b16b-4bf3-a08b-29ceb53fdcbc"></video><p>The <code>Proposal</code> is able to detect when the associated <code>Package</code> is complete because the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Event/Listeners/PackageEventListener.cs#L30" target="_blank" rel="noopener noreferrer"><code>PackageListener.OnStateChanged</code></a> event triggers the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Saga/PackageSaga.cs#L49" target="_blank" rel="noopener noreferrer"><code>PackageSaga.OnStateChanged</code></a> method. The <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/components/proposal-card.component.ts#L117" target="_blank" rel="noopener noreferrer"><code>ProposalCardComponent</code></a> is able to track whether a <code>Package</code> can be submitted via the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/components/proposal-card.component.ts#L117" target="_blank" rel="noopener noreferrer"><code>canSubmit</code></a> function, which is kept synchronized through the <a href="https://github.com/JaimeStill/distributed-design/blob/main/apps/proposals/src/app/components/proposal-card.component.ts#L106" target="_blank" rel="noopener noreferrer"><code>handlePackageEvent</code></a> trigger.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-up-contracts">Cleaning Up Contracts<a href="#cleaning-up-contracts" class="hash-link" aria-label="Direct link to Cleaning Up Contracts" title="Direct link to Cleaning Up Contracts">​</a></h3><p>It&#x27;s easy to synchronize internal state with changes to contracts through events because the node is aware of the remote node. The inverse, however, is not true. The remote node is never aware of the nodes that consume it. The only link it ever has to its dependent nodes is through the contract data it receives. If a <code>Package</code> contract is submitted based on an associated <code>Proposal</code> and the <code>Proposal</code> is later removed, how does the corresponding <code>Package</code> get cleaned up as well?</p><p>By leveraging <code>Command</code> hooks and <code>Gateway</code> services, associated contract data can be cleaned up. The following clip demonstrates submitting a <code>Package</code>, then removing the associated <code>Proposal</code>:</p><video controls="" width="100%"><source src="https://github.com/JaimeStill/distributed-design/assets/14102723/3fca664c-1a1d-4cf0-aa56-ab80a36a1476"></video><p>If you look at the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs" target="_blank" rel="noopener noreferrer"><code>ProposalCommand</code></a> service, you&#x27;ll see that the <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/workflows/WorkflowsGateway.cs" target="_blank" rel="noopener noreferrer"><code>WorkflowsGateway</code></a> service is <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs#L16" target="_blank" rel="noopener noreferrer">injected in the constructor</a>. The <a href="https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs#L46" target="_blank" rel="noopener noreferrer"><code>AfterRemove</code></a> hook tries to retrieve an active <code>Package</code> associated with the <code>Proposal</code> being removed. If it is found, the <code>WorkflowsGateway.WithdrawPackage</code> method is called. If the package is unable to be withdrawn for any reason, the whole transaction will be aborted and the <code>Proposal</code> will not be removed.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/distributed-design/getting-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting Started</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/distributed-design/deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a></li><li><a href="#internal-node-synchronization" class="table-of-contents__link toc-highlight">Internal Node Synchronization</a></li><li><a href="#cross-node-synchronization" class="table-of-contents__link toc-highlight">Cross-Node Synchronization</a><ul><li><a href="#submitting-a-contract" class="table-of-contents__link toc-highlight">Submitting a Contract</a></li><li><a href="#reacting-to-contract-changes" class="table-of-contents__link toc-highlight">Reacting to Contract Changes</a></li><li><a href="#cleaning-up-contracts" class="table-of-contents__link toc-highlight">Cleaning Up Contracts</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/distributed-design/assets/js/runtime~main.7ae0a603.js"></script>
<script src="/distributed-design/assets/js/main.38f205fa.js"></script>
</body>
</html>