"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[988],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(a),k=o,h=d["".concat(p,".").concat(k)]||d[k]||m[k]||r;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=k;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},9794:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var n=a(7462),o=(a(7294),a(3905));const r={sidebar_position:2,title:"Walkthrough"},i="Feature Walkthrough",s={unversionedId:"walkthrough",id:"walkthrough",title:"Walkthrough",description:"The following guide will walk through some of the primary features of the framework, and point to some of the infrastructure that drives it.",source:"@site/docs/walkthrough.md",sourceDirName:".",slug:"/walkthrough",permalink:"/distributed-design/walkthrough",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Walkthrough"},sidebar:"docsSidebar",previous:{title:"Overview",permalink:"/distributed-design/"}},p={},l=[{value:"Setup",id:"setup",level:2},{value:"Reactivity and After-Effects",id:"reactivity-and-after-effects",level:2},{value:"Contract Cleanup with Gateways",id:"contract-cleanup-with-gateways",level:2}],c={toc:l},d="wrapper";function m(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"feature-walkthrough"},"Feature Walkthrough"),(0,o.kt)("p",null,"The following guide will walk through some of the primary features of the framework, and point to some of the infrastructure that drives it."),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Fork this repository and create a Codespace:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"codespace-with-options",src:a(3849).Z,width:"948",height:"537"})),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"codespace-settings",src:a(5376).Z,width:"887",height:"578"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once the Codespace has loaded and the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/.devcontainer/devcontainer.json#L79"},(0,o.kt)("inlineCode",{parentName:"a"},"postCreateCommand"))," has finished executing, be sure to go to extensions and reload to finalize the extension settings:"),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"You will get a Language Server client error on initial load. This is because the extensions are still installing and need to be reloaded per this step.")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"extension-reload",src:a(2930).Z,width:"1456",height:"864"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set the forwarded API ports (labeled ",(0,o.kt)("strong",{parentName:"p"},"Proposals API (5001)")," and ",(0,o.kt)("strong",{parentName:"p"},"Workflows API (5002)"),") to ",(0,o.kt)("strong",{parentName:"p"},"Public"),". If the bottom panel isn't already open, type ",(0,o.kt)("kbd",null,"Ctrl + `"),". Click the ",(0,o.kt)("strong",{parentName:"p"},"Ports")," tab. Right-click the port and set to ",(0,o.kt)("strong",{parentName:"p"},"Public"),":"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"port-visibility",src:a(9467).Z,width:"936",height:"434"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open the ",(0,o.kt)("strong",{parentName:"p"},"Task Explorer")," panel in the side bar and run the ",(0,o.kt)("inlineCode",{parentName:"p"},"distributed-design/vscode/apps/build-and-install")," task:"),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"Close all of the task terminals when they are complete")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"build-and-install",src:a(7615).Z,width:"1714",height:"1129"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open 3 terminals (",(0,o.kt)("kbd",null,"Ctrl + Shift + `")," opens a new terminal) and run the following in each terminal:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Proposals API")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ./nodes/proposals/Proposals.Api\ndotnet run\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Workflows API")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ./nodes/workflows/Workflows.Api\ndotnet run\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Workflows App")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ./apps/workflows\nnpm run start:code\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("strong",{parentName:"p"},"Ports")," tab of the bottom panel, you can open the process associated with each port in a new tab by clicking the globe icon in the ",(0,o.kt)("strong",{parentName:"p"},"Forwarded Address")," column. Open the ",(0,o.kt)("strong",{parentName:"p"},"Workflows App")," and ",(0,o.kt)("strong",{parentName:"p"},"Proposals API"),"."),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"Once the URL resolves for the API, it will look like you hit a dead page. Add ",(0,o.kt)("inlineCode",{parentName:"p"},"/swagger")," to the end of the URL and it will open the Swagger interface.")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"running-processes",src:a(9687).Z,width:"2173",height:"859"})),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"For the remainder of the walkthrough, you will want your windows positioned as shown above. This way, when Package data is mutated, you can see the effects in real time in the Workflows app.")))),(0,o.kt)("h2",{id:"reactivity-and-after-effects"},"Reactivity and After-Effects"),(0,o.kt)("p",null,"The following section will demonstrate how the API facilitates real time data synchronization and facilitates cross-node interactivity."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the browser tab for the ",(0,o.kt)("strong",{parentName:"p"},"Proposals API")," Swagger interface, expand the ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Proposal/Save")," endpoint. Click ",(0,o.kt)("strong",{parentName:"p"},"Try it out")," and paste the following value and click ",(0,o.kt)("strong",{parentName:"p"},"Execute"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "value": "Demonstrate reactivity and after-effects",\n    "title": "Reactivity Proposal"\n}\n')),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"proposal-success",src:a(6904).Z,width:"1069",height:"297"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("strong",{parentName:"p"},"Workflows")," section, expand the ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Workflows/SubmitPackage")," endpoint. Click ",(0,o.kt)("strong",{parentName:"p"},"Try it out"),", paste the following value, and click ",(0,o.kt)("strong",{parentName:"p"},"Execute"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "value": "string",\n    "state": "Pending",\n    "result": "Created",\n    "entityId": 1,\n    "entityType": "Proposals.Entities.Proposal",\n    "context": "Approval for Acquisition",\n    "title": "Proposal Package"\n}\n')),(0,o.kt)("video",{controls:!0,width:"100%"},(0,o.kt)("source",{src:"https://github.com/JaimeStill/distributed-design/assets/14102723/476bdc17-f9d4-45c4-b978-4192e695fa6c"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In the ",(0,o.kt)("strong",{parentName:"p"},"Proposals")," section, expand ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Proposal/Get"),", click ",(0,o.kt)("strong",{parentName:"p"},"Try it out"),", and click ",(0,o.kt)("strong",{parentName:"p"},"Execute"),". You'll notice that the ",(0,o.kt)("inlineCode",{parentName:"p"},"Proposal")," has been modified with ",(0,o.kt)("inlineCode",{parentName:"p"},'"packageId": 1'),". This is because the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Event/Listeners/PackageEventListener.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"PackageListener"))," intercepts ",(0,o.kt)("inlineCode",{parentName:"p"},"OnAdd")," events from the ",(0,o.kt)("strong",{parentName:"p"},"Workflows API")," () and passes them to the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Saga/PackageSaga.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"PackageSaga.OnAdd"))," handler."),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Event/PackageEventHub.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"PackageEventHub"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Services/Command/PackageCommand.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"PackageCommand")),". The ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/core/Services/EntityCommand.cs#L44"},(0,o.kt)("strong",{parentName:"a"},"Sync hooks"))," in the underlying ",(0,o.kt)("inlineCode",{parentName:"p"},"EntityCommand")," broadcast events for ",(0,o.kt)("em",{parentName:"p"},"Add"),", ",(0,o.kt)("em",{parentName:"p"},"Update"),", and ",(0,o.kt)("em",{parentName:"p"},"Remove"),".")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"proposal-with-package-id",src:a(5254).Z,width:"843",height:"292"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Additionally, if a Package is removed and it is the active Package for a Proposal, the Saga will set ",(0,o.kt)("inlineCode",{parentName:"p"},"Proposal.PackageId = null"),". Navigate to the ",(0,o.kt)("strong",{parentName:"p"},"Workflows")," section, expand ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Workflows/GetPackagesByType/{entityType}"),", click ",(0,o.kt)("strong",{parentName:"p"},"Try it out"),", type ",(0,o.kt)("inlineCode",{parentName:"p"},"Proposals.Entities.Proposal")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"entityType")," field, then click ",(0,o.kt)("strong",{parentName:"p"},"Execute"),":"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"get-packages-by-type",src:a(4956).Z,width:"839",height:"345"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Copy the Package object in the ",(0,o.kt)("strong",{parentName:"p"},"Response body")," section, expand ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Workflows/WithdrawPackage"),", click ",(0,o.kt)("strong",{parentName:"p"},"Try it out"),", paste the JSON object into the ",(0,o.kt)("strong",{parentName:"p"},"Request body")," section, and click ",(0,o.kt)("strong",{parentName:"p"},"Execute"),":"),(0,o.kt)("video",{controls:!0,width:"100%"},(0,o.kt)("source",{src:"https://github.com/JaimeStill/distributed-design/assets/14102723/8fec8622-94db-463a-8cd1-70446bf253d2"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In addition to the Package disappearing in the ",(0,o.kt)("strong",{parentName:"p"},"Workflows App"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Proposal.PackageId")," was also set to null. Verify by executing the ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Proposal/Get")," endpoint:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"proposal-without-package",src:a(8703).Z,width:"841",height:"276"})))),(0,o.kt)("h2",{id:"contract-cleanup-with-gateways"},"Contract Cleanup with Gateways"),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"Workflows")," endpoints in the ",(0,o.kt)("strong",{parentName:"p"},"Proposals API")," are just a proxy to the ",(0,o.kt)("strong",{parentName:"p"},"Workflows API"),". When the endpoint is hit in the ",(0,o.kt)("strong",{parentName:"p"},"Proposals API"),", the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Api/Controllers/WorkflowsController.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"WorkflowsController"))," receives the request and forwards it to the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/workflows/Workflows.Api/Controllers/GatewayController.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"GatewayController"))," in the ",(0,o.kt)("strong",{parentName:"p"},"Workflows API")," through the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/contracts/workflows/WorkflowsGateway.cs"},(0,o.kt)("inlineCode",{parentName:"a"},"WorkflowsGateway"))," client."),(0,o.kt)("p",null,"Sagas and Event Listeners work great for reacting to changes in data exposed through public contracts. But how would you handle the inverse? If we delete a Proposal and there is a Package associated with it, Proposal is not exposed as a contract for the ",(0,o.kt)("strong",{parentName:"p"},"Workflows API")," to build infrastructure around. To handle this scenario, we can leverage injecting the ",(0,o.kt)("strong",{parentName:"p"},"Gateway")," client into a command service and handling cleanup inside of service hooks."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create another Package using the below JSON object at the ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Workflows/SubmitPackage")," endpoint:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "value": "string",\n    "state": "Pending",\n    "result": "Created",\n    "entityId": 1,\n    "entityType": "Proposals.Entities.Proposal",\n    "context": "Approval for Acquisition",\n    "title": "Proposal Package"\n}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Execute the ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Proposals/Get")," endpoint and copy the JSON object for the proposal:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"get-package-again",src:a(1617).Z,width:"838",height:"289"}))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Paste the Proposal JSON object into ",(0,o.kt)("inlineCode",{parentName:"p"},"/api/Proposals/Remove")," and Execute. You will notice that the Package in the ",(0,o.kt)("strong",{parentName:"p"},"Workflows App")," is removed along with the Proposal:"),(0,o.kt)("video",{controls:!0,width:"100%"},(0,o.kt)("source",{src:"https://github.com/JaimeStill/distributed-design/assets/14102723/b7504f08-dc1b-4e3d-b446-f72688df7fdb"})))),(0,o.kt)("p",null,"This is because the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs#L46"},(0,o.kt)("inlineCode",{parentName:"a"},"ProposalCommand"))," will clean up any active package associated with it when it is being removed in the ",(0,o.kt)("inlineCode",{parentName:"p"},"AfterRemove")," service hook. It is able to do so because ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/JaimeStill/distributed-design/blob/main/nodes/proposals/Proposals.Services/Command/ProposalCommand.cs#L16"},(0,o.kt)("inlineCode",{parentName:"a"},"WorkflowsGateway")," is injected into ",(0,o.kt)("inlineCode",{parentName:"a"},"ProposalCommand")),"."))}m.isMDXComponent=!0},7615:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/build-and-install-b08d19f301cf497ae23172f71488b0e8.png"},5376:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/codespace-settings-b049a1fd369e8a7aeec4ac2f2c424fe5.png"},3849:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/codespace-with-options-696eec6ec7a3f15f33f1c6196c416520.png"},2930:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/extension-reload-d8faf6becb8c06931bbd6b3f915de460.png"},1617:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/get-package-again-05e8624ef45e6c57b509e8835b106a5a.png"},4956:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/get-packages-by-type-d0aced4275d186a0175b5c8a7f8a4cc6.png"},9467:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/port-visibility-8000361919ebf69fb807b9165d23f2fa.png"},6904:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/proposal-success-e621f3176ac9f6729ec142d35c220da4.png"},5254:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/proposal-with-package-id-6b31324aab466b1d74742728aff2c3cd.png"},8703:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/proposal-without-package-469c7a7ae7a7582943d38f3b70e8089f.png"},9687:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/running-processes-8e57580ffe174d1cc3c5dd6026c2a4ce.png"}}]);